<div
	*ngIf="loading"
	class="d-flex justify-content-center align-items-center opacity-50 position-absolute"
	style="
		width: 100vw;
		height: 100svh;
		z-index: 10000;
		background-color: black;
	"
>
	<div class="spinner-border" role="status">
		<span class="visually-hidden">Loading...</span>
	</div>
</div>

<!-- TODO: Remove !loading and check if object is already loaded -->
<div id="wrapper" *ngIf="!loading">
	<div
		id="main-container"
		[ngClass]="{ 'p-3': true, 'w-75': trainingPrograms.length !== 0 }"
	>
		<h1 class="text-center my-4">
			{{
				trainingPrograms.length > 0
					? "Scegli una scheda di allenamento"
					: "Non ci sono schede di allenamento"
			}}
		</h1>

		<button
			class="btn btn-dark ms-2 mb-3 d-none d-lg-block"
			routerLink="/home/dashboard"
		>
			Torna alla home
			<i class="ms-1 bi bi-house-fill"></i>
		</button>

		<button
			class="btn btn-sm btn-dark ms-2 mb-3 d-block d-lg-none"
			routerLink="/home/dashboard"
		>
			Torna alla home
			<i class="ms-1 bi bi-house-fill"></i>
		</button>

		<img
			*ngIf="trainingPrograms.length === 0"
			src="assets/no-old-workouts.svg"
			alt="No workouts found"
			style="width: 50%"
		/>

		<div
			*ngFor="let program of trainingPrograms; index as programIndex"
			class="w-100 mb-2"
		>
			<a
				[href]="'#program' + programIndex"
				class="btn btn-light w-100 mb-1 border programs-collapser collapser d-flex justify-content-between align-items-center mobile-btn"
				data-bs-toggle="collapse"
				role="button"
				aria-expanded="false"
				aria-controls="collapseExample"
				(click)="focusCollapse('program', programIndex)"
			>
				<p class="text-center mb-0">{{ program.name }}</p>
				<p class="mb-0">
					{{ "Sessioni: " + program.session.length }}
				</p>
			</a>

			<div
				class="collapse w-100 programs-collapse-body collapse-body"
				[id]="'program' + programIndex"
			>
				<div class="card card-body p-1">
					<h5 class="text-center">Sessioni</h5>
					<div
						*ngFor="
							let session of program.session;
							index as sessionIndex
						"
						class="w-100 mb-2"
					>
						<a
							[href]="'#session' + programIndex + sessionIndex"
							class="btn btn-light w-100 mb-1 border collapser sessions-collapser d-flex justify-content-between align-items-center mobile-btn"
							data-bs-toggle="collapse"
							role="button"
							aria-expanded="false"
							aria-controls="collapseExample"
							(click)="focusCollapse('session', sessionIndex)"
						>
							<p class="text-center mb-0">
								{{ session.name }}
							</p>
						</a>

						<div
							class="collapse w-100 sessions-collapse-body collapse-body"
							[id]="'session' + programIndex + sessionIndex"
						>
							<div class="card card-body p-1">
								<table
									class="table table-sm table-striped table-hover"
								>
									<thead>
										<tr>
											<th scope="col">Esercizio</th>
											<th scope="col">Serie</th>
											<th scope="col">Intensit√†</th>
										</tr>
									</thead>
									<tbody class="table-group-divider">
										<tr
											*ngFor="
												let exercise of session.exercises;
												index as exerciseIndex
											"
										>
											<th>
												<i
													*ngIf="
														exercise.note &&
														exercise.note != ''
													"
													(click)="
														showNotes(
															programIndex,
															sessionIndex,
															exerciseIndex
														)
													"
													style="cursor: pointer"
													class="me-1 bi bi-info-circle-fill"
												></i>
												{{ exercise.name }}
											</th>

											<td>
												<div class="d-flex flex-column">
													<div
														*ngFor="
															let set of formatSets(
																exercise.set
															);
															index as setIndex
														"
													>
														{{ set }}
													</div>
												</div>
											</td>

											<td>
												<!--Desktop-->
												<p
													*ngIf="
														exercise.intensity ===
														'light'
													"
													class="bg-success mb-0 d-none d-lg-block text-light px-3 py-1 rounded-5"
													style="width: fit-content"
												>
													Leggero
													<i
														class="ms-1 bi bi-feather"
													></i>
												</p>
												<p
													*ngIf="
														exercise.intensity ===
														'hard'
													"
													class="bg-warning mb-0 d-none d-lg-block text-light px-3 py-1 rounded-5"
													style="width: fit-content"
												>
													Pesante
													<i
														class="ms-1 bi bi-lightning-fill"
													></i>
												</p>
												<p
													*ngIf="
														exercise.intensity ===
														'failure'
													"
													class="bg-danger mb-0 d-none d-lg-block text-light px-3 py-1 rounded-5"
													style="width: fit-content"
												>
													Cedimento
													<i
														class="ms-1 bi bi-fire"
													></i>
												</p>

												<!--Mobile-->
												<p
													*ngIf="
														exercise.intensity ===
														'light'
													"
													class="bg-success mb-0 d-block d-lg-none text-light px-2 py-1 rounded-5"
													style="width: fit-content"
												>
													<i
														class="bi bi-feather"
													></i>
												</p>
												<p
													*ngIf="
														exercise.intensity ===
														'hard'
													"
													class="bg-warning mb-0 d-block d-lg-none text-light px-2 py-1 rounded-5"
													style="width: fit-content"
												>
													<i
														class="bi bi-lightning-fill"
													></i>
												</p>
												<p
													*ngIf="
														exercise.intensity ===
														'failure'
													"
													class="bg-danger mb-0 d-block d-lg-none text-light px-2 py-1 rounded-5"
													style="width: fit-content"
												>
													<i class="bi bi-fire"></i>
												</p>
											</td>
										</tr>
									</tbody>
								</table>
								<button
									class="btn btn-dark d-none d-lg-block"
									(click)="
										selectWorkout(
											programIndex,
											sessionIndex
										)
									"
								>
									Seleziona
									<i class="ms-1 bi bi-check2-circle"></i>
								</button>

								<button
									class="btn btn-sm btn-dark d-block d-lg-none"
									(click)="
										selectWorkout(
											programIndex,
											sessionIndex
										)
									"
								>
									Seleziona
									<i class="ms-1 bi bi-check2-circle"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- <mat-progress-bar
	*ngIf="this.loading"
	mode="indeterminate"
	color="primary"
></mat-progress-bar>
<div id="training-program-selector-container">
	<div id="title-container">
		<h1><span id="title">Scegli la scheda</span></h1>
	</div>

	<ng-container
		*ngIf="
			(this.trainingPrograms == undefined ||
				this.trainingPrograms.length == 0) &&
			!this.loading
		"
	>
		<p id="info-text">Non ci sono schede</p>
	</ng-container>

	<mat-accordion>
		<mat-expansion-panel
			hideToggle
			*ngFor="
				let program of this.trainingPrograms;
				index as trainingProgramIndex
			"
		>
			<mat-expansion-panel-header>
				<mat-panel-title>{{ program.name }}</mat-panel-title>
				<mat-panel-description>
					Numero di sessioni: {{ program.session.length }}
				</mat-panel-description>
			</mat-expansion-panel-header>

			<mat-accordion>
				<mat-expansion-panel
					hideToggle
					*ngFor="
						let session of program.session;
						index as sessionIndex
					"
				>
					<mat-expansion-panel-header>
						<mat-panel-title>{{ session.name }}</mat-panel-title>
						<mat-panel-description>
							Numero di esercizi: {{ session.exercises.length }}
						</mat-panel-description>
					</mat-expansion-panel-header>

					<table class="table">
						<thead>
							<tr>
								<th scope="col">Nome</th>
								<th scope="col">Serie-Ripetizioni</th>
								<th scope="col">RPE</th>
								<th scope="col">Riposo</th>
								<th scope="col">Note</th>
							</tr>
						</thead>
						<tbody>
							<tr
								*ngFor="
									let exercise of session.exercises;
									index as exerciseIndex
								"
							>
								<th scope="row">{{ exercise.name }}</th>
								<td>
									<ng-container
										*ngIf="
											exercise.configurationType ===
											'advanced'
										"
									>
										<ng-container
											*ngFor="
												let set of exercise.advanced
													.sets;
												index as i
											"
										>
											<b>{{ i + 1 + ":" }}</b>
											{{
												set.min != set.max
													? set.min +
													  " reps - " +
													  set.max +
													  " reps"
													: set.min + " reps"
											}}
											<br />
										</ng-container>
									</ng-container>

									<ng-container
										*ngIf="
											!exercise.configurationType ||
											exercise.configurationType ===
												'basic'
										"
									>
										{{
											exercise.series > 0
												? exercise.series +
												  "x" +
												  (exercise.range &&
												  exercise.range[0] !=
														exercise.range[1]
														? exercise.range[0] +
														  "-" +
														  exercise.range[1]
														: exercise.reps
														? exercise.reps
														: exercise.range[0])
												: "/"
										}}
									</ng-container>
								</td>
								<td>{{ exercise.RPE }}</td>
								<td>
									{{
										exercise.rest
											? exercise.rest.minutes +
											  ":" +
											  exercise.rest.seconds
											: exercise.restTime
											? exercise.restTime
											: "/"
									}}
								</td>
								<td>
									<i
										*ngIf="
											exercise.note && exercise.note != ''
										"
										class="bi bi-question-circle-fill"
										style="cursor: pointer"
										(click)="
											showNotes(
												trainingProgramIndex,
												sessionIndex,
												exerciseIndex
											)
										"
									></i>
								</td>
							</tr>
						</tbody>
					</table>

					<div
						style="
							display: flex;
							flex-direction: row;
							justify-content: flex-end;
						"
					>
						<button
							class="btn btn-primary custom-button"
							color="primary"
							(click)="
								selectWorkout(
									trainingProgramIndex,
									sessionIndex
								)
							"
						>
							Seleziona
						</button>
					</div>
				</mat-expansion-panel>
			</mat-accordion>
		</mat-expansion-panel>
	</mat-accordion>

	<div id="cancel-button-container">
		<button class="btn btn-outline-danger" color="warn" (click)="cancel()">
			Annulla
		</button>
	</div>
</div>
 -->
