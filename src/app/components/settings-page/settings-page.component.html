<div
	*ngIf="loading"
	class="d-flex justify-content-center align-items-center opacity-50 position-absolute"
	style="
		width: 100vw;
		height: 100svh;
		z-index: 10000;
		background-color: black;
	"
>
	<div class="spinner-border" role="status">
		<span class="visually-hidden">Loading...</span>
	</div>
</div>

<!-- TODO: Remove !loading and check if object is already loaded -->
<div id="wrapper" *ngIf="!loading">
	<div id="main-container" class="p-3">
		<div class="h-100 w-100 d-flex flex-column align-items-center">
			<h1 class="text-center">Profilo</h1>

			<img
				class="mb-2 mt-4 d-none d-lg-block"
				src="assets/profile.png"
				width="200"
				alt="Profile pic"
			/>
			<img
				class="mb-2 mt-4 d-block d-lg-none"
				src="assets/profile.png"
				width="150"
				alt="Profile pic"
			/>

			<p *ngIf="username" class="w-100 text-center text-wrap">
				{{ username }}
			</p>

			<div class="d-flex justify-content-center align-items-center mb-4">
				<!-- Share -->
				<button
					*ngIf="username"
					(click)="shareUsername()"
					class="btn btn-light rounded-5 shadow-sm btn-sm,"
					style="border: none"
				>
					<i class="bi bi-box-arrow-up"></i>
				</button>
				<button
					*ngIf="!username"
					disabled
					class="btn btn-light rounded-5 shadow-sm btn-sm,"
					style="border: none"
				>
					<i class="bi bi-box-arrow-up"></i>
				</button>
			</div>

			<!-- 			<div class="form-check mb-4">
				<input
					id="checkbox-profile"
					class="form-check-input"
					type="checkbox"
					[(ngModel)]="visibility"
					[checked]="visibility"
				/>
				<label
					class="form-check-label d-none d-lg-block"
					for="checkbox-profile"
				>
					Rendi visibili le tue schede agli altri
				</label>
				<label
					class="form-check-label d-block d-lg-none"
					for="checkbox-profile"
					style="font-size: small"
				>
					Rendi visibili le tue schede agli altri
				</label>
			</div> -->

			<button
				(click)="openExcerciseDialog()"
				class="d-flex btn btn-light border-0 shadow-sm rounded-3 mb-3 p-2 w-100 d-none d-lg-block"
			>
				<i class="me-2 bi bi-arrows-angle-expand"></i>
				Esercizi custom
			</button>

			<button
				(click)="openExcerciseDialog()"
				class="d-flex btn btn-sm btn-light border-0 shadow-sm rounded-3 mb-3 p-2 w-100 d-block d-lg-none"
			>
				<i class="me-2 bi bi-arrows-angle-expand"></i>
				Esercizi custom
			</button>

			<button
				class="d-flex btn btn-dark border-0 shadow-sm rounded-3 mb-4 p-2 w-100 d-none d-lg-block"
				(click)="backToHome()"
			>
				<i class="me-2 bi bi-house-fill"></i>
				Torna alla home
			</button>

			<button
				class="d-flex btn btn-sm btn-dark border-0 shadow-sm rounded-3 mb-4 p-2 w-100 d-block d-lg-none"
				(click)="backToHome()"
			>
				<i class="me-2 bi bi-house-fill"></i>
				Torna alla home
			</button>

			<div class="w-100 d-flex flex-column">
				<h5>
					Impostazioni
					<i class="ms-2 bi bi-gear-wide-connected"></i>
				</h5>

				<div class="w-100 d-flex flex-column">
					<!-- Username Desktop -->
					<button
						class="d-none d-lg-flex btn btn-light border-0 shadow-sm rounded-3 p-2"
						data-bs-toggle="collapse"
						data-bs-target="#collapseUsername"
						aria-expanded="false"
						aria-controls="collapseUsername"
						(click)="resetUsernameInput()"
					>
						<i class="me-2 bi bi-person-lines-fill"></i>
						Modifica Username
					</button>

					<div
						class="collapse mt-2 collapseDesktop"
						id="collapseUsername"
					>
						<div class="card card-body border-0 p-0">
							<div class="d-flex align-items-center">
								<input
									type="text"
									class="form-control rounded-3"
									placeholder="Username"
									aria-label="Username"
									aria-describedby="button-addon2"
									[(ngModel)]="username"
								/>
								<i
									*ngIf="isUsernameValid()"
									class="bi bi-check-lg mx-2 saveUsernameBtn"
									style="color: #6b44d4; cursor: pointer"
									(click)="saveSettings($event)"
								></i>
								<i
									*ngIf="!isUsernameValid()"
									class="bi bi-check-lg mx-2"
									disabled
									style="color: #9883d3"
								></i>
							</div>
						</div>
					</div>

					<!-- Username Mobile -->
					<button
						class="d-flex d-lg-none btn btn-sm btn-light border-0 shadow-sm rounded-3 p-2"
						data-bs-toggle="collapse"
						data-bs-target="#collapseUsernameMobile"
						aria-expanded="false"
						aria-controls="collapseUsernameMobile"
						(click)="resetUsernameInput()"
					>
						<i class="me-2 bi bi-person-lines-fill"></i>
						Modifica Username
					</button>

					<div
						class="collapse mt-2 collapseMobile"
						id="collapseUsernameMobile"
					>
						<div class="card card-body border-0 p-0">
							<div class="d-flex align-items-center">
								<input
									type="text"
									class="form-control form-control-sm rounded-3"
									placeholder="Username"
									aria-label="Username"
									aria-describedby="button-addon2"
									[(ngModel)]="username"
								/>
								<i
									*ngIf="isUsernameValid()"
									class="bi bi-check-lg mx-2 saveUsernameBtnMobile"
									style="color: #6b44d4; cursor: pointer"
									(click)="saveSettings($event)"
								></i>
								<i
									*ngIf="!isUsernameValid()"
									class="bi bi-check-lg mx-2"
									disabled
									style="color: #9883d3"
								></i>
							</div>
						</div>
					</div>

					<!-- Visibilty Desktop -->
					<button
						class="d-none d-lg-flex btn btn-light border-0 shadow-sm rounded-3 p-2 mt-3"
						data-bs-toggle="collapse"
						data-bs-target="#collapseVisibility"
						aria-expanded="false"
						aria-controls="collapseVisibility"
						(click)="resetUsernameInput()"
					>
						<i
							*ngIf="!visibility"
							class="me-2 bi bi-eye-slash-fill"
						></i>
						<i *ngIf="visibility" class="me-2 bi bi-eye-fill"></i>
						Modifica Visibilità
					</button>

					<div
						class="collapse mt-2 collapseDesktop"
						id="collapseVisibility"
					>
						<div class="card card-body border-0 p-0">
                            <div class="form-check form-switch">
                                <input
                                    class="form-check-input updateVisibilityBtn"
                                    type="checkbox"
                                    role="switch"
                                    id="flexSwitchCheckChecked"
                                    [checked]="visibility"
                                    [(ngModel)]="visibility"
                                    (change)="saveSettings($event)"
                                />
                                <label
                                    class="form-check-label"
                                    for="flexSwitchCheckChecked"
                                >
                                    Rendi visibili le tue schede agli altri
                                </label>
                            </div>
						</div>
					</div>

					<!-- Visibility Mobile -->
					<button
						class="d-flex d-lg-none btn btn-sm btn-light border-0 shadow-sm rounded-3 p-2 mt-3"
						data-bs-toggle="collapse"
						data-bs-target="#collapseVisibilityMobile"
						aria-expanded="false"
						aria-controls="collapseVisibilityMobile"
						(click)="resetUsernameInput()"
					>
						<i
							*ngIf="!visibility"
							class="me-2 bi bi-eye-slash-fill"
						></i>
						<i *ngIf="visibility" class="me-2 bi bi-eye-fill"></i>
						Modifica Visibilità
					</button>

					<div
						class="collapse mt-2 collapseMobile"
						id="collapseVisibilityMobile"
					>
						<div class="card card-body border-0 p-0">
							<div class="form-check form-switch">
                                <input
                                    class="form-check-input updateVisibilityBtnMobile"
                                    type="checkbox"
                                    role="switch"
                                    id="flexSwitchCheckChecked"
                                    [checked]="visibility"
                                    (change)="saveSettings($event)"
                                />
                                <label
                                    class="form-check-label"
                                    for="flexSwitchCheckChecked"
                                >
                                    Rendi visibili le tue schede agli altri
                                </label>
                            </div>
						</div>
					</div>

					<!-- Playlist Desktop -->
					<button
						class="btn btn-light border-0 shadow-sm rounded-3 p-2 mt-3 d-none d-lg-flex"
						data-bs-toggle="collapse"
						data-bs-target="#collapsePlaylist"
						aria-expanded="false"
						aria-controls="collapsePlaylist"
						(click)="resetPlaylistUrlInput()"
					>
						<i class="me-2 bi bi-spotify"></i>
						Modifica Playlist Spotify
					</button>

					<div
						class="collapse mt-2 collapseDesktop"
						id="collapsePlaylist"
					>
						<div class="card card-body border-0 p-0">
							<div class="d-flex align-items-center">
								<input
									type="text"
									class="form-control rounded-3"
									placeholder="Playlist URL"
									aria-label="Playlist URL"
									aria-describedby="button-addon2"
									[(ngModel)]="playlistUrl"
								/>
								<i
									*ngIf="isPlaylistUrlValid()"
									class="bi bi-check-lg mx-2 savePlaylistBtn"
									style="color: #6b44d4; cursor: pointer"
									(click)="saveSettings($event)"
								></i>
								<i
									*ngIf="!isPlaylistUrlValid()"
									class="bi bi-check-lg mx-2"
									disabled
									style="color: #9883d3"
								></i>
							</div>
						</div>
					</div>

					<!-- Playlist Mobile -->
					<button
						class="btn btn-sm btn-light border-0 shadow-sm rounded-3 p-2 mt-3 d-flex d-lg-none"
						data-bs-toggle="collapse"
						data-bs-target="#collapsePlaylistMobile"
						aria-expanded="false"
						aria-controls="collapsePlaylistMobile"
						(click)="resetPlaylistUrlInput()"
					>
						<i class="me-2 bi bi-spotify"></i>
						Modifica Playlist Spotify
					</button>

					<div
						class="collapse mt-2 collapseMobile"
						id="collapsePlaylistMobile"
					>
						<div class="card card-body border-0 p-0">
							<div class="d-flex align-items-center">
								<input
									type="text"
									class="form-control form-control-sm rounded-3"
									placeholder="Playlist URL"
									aria-label="Playlist URL"
									aria-describedby="button-addon2"
									[(ngModel)]="playlistUrl"
								/>
								<i
									*ngIf="isPlaylistUrlValid()"
									class="bi bi-check-lg mx-2 savePlaylistBtnMobile"
									style="color: #6b44d4; cursor: pointer"
									(click)="saveSettings($event)"
								></i>
								<i
									*ngIf="!isPlaylistUrlValid()"
									class="bi bi-check-lg mx-2"
									disabled
									style="color: #9883d3"
								></i>
							</div>
						</div>
					</div>

					<!-- Password -->
					<button
						class="btn btn-light border-0 shadow-sm rounded-3 p-2 mt-3 d-none d-lg-flex"
						(click)="changePassword()"
					>
						<i class="me-2 bi bi-lock-fill"></i>
						Modifica Password
					</button>

					<button
						class="btn btn-sm btn-light border-0 shadow-sm rounded-3 p-2 mt-3 d-flex d-lg-none"
						(click)="changePassword()"
					>
						<i class="me-2 bi bi-lock-fill"></i>
						Modifica Password
					</button>

					<!-- Delete -->
					<button
						class="btn btn-danger border-0 shadow-sm rounded-3 p-2 my-3 d-none d-lg-flex"
						(click)="deleteAccount()"
					>
						<i class="me-2 bi bi-trash3-fill"></i>
						Elimina Account
					</button>

					<button
						class="btn btn-sm btn-danger border-0 shadow-sm rounded-3 p-2 my-3 d-flex d-lg-none"
						(click)="deleteAccount()"
					>
						<i class="me-2 bi bi-trash3-fill"></i>
						Elimina Account
					</button>
				</div>
			</div>
		</div>
	</div>
</div>
