<div id="wrapper">
	<div id="main-container" class="p-3">
		<h1 class="text-center mt-3">Crea allenamento</h1>

		<div class="d-flex flex-column align-items-center">
			<div class="d-flex justify-content-center align-items-center">
				<button
					type="button"
					class="btn btn-dark me-2 d-none d-lg-flex"
					routerLink="/home/dashboard"
				>
					<i class="me-1 bi bi-house-fill"></i>
					Home
				</button>
				<button
					type="button"
					class="btn btn-sm btn-dark me-2 d-flex d-lg-none"
					routerLink="/home/dashboard"
				>
					<i class="bi bi-house-fill"></i>
				</button>

				<div class="d-flex flex-column w-50 mx-2 mb-3 mt-2 input-container">
					<p class="mb-0 text-center">Allenamento</p>
					<input
						type="text"
						class="border-0 border-bottom py-1"
						style="background-color: transparent"
					/>
				</div>

				<button
					type="button"
					class="btn text-light save-btn ms-2 d-none d-lg-flex"
					style="border: none; background-color: #6b44d4"
					[disabled]="!savable()"
					(click)="saveWorkout()"
				>
					Salva
					<i class="ms-1 bi bi-check"></i>
				</button>
				<button
					type="button"
					class="btn save-btn btn-sm text-light ms-2 d-flex d-lg-none"
					style="border: none; background-color: #6b44d4"
					[disabled]="!savable()"
					(click)="saveWorkout()"
				>
					<i class="bi bi-check"></i>
				</button>
			</div>

			<div class="mb-3">
				<div class="input-group flex-nowrap mb-4">
					<span class="input-group-text">Data</span>
					<input
						type="date"
						class="form-control"
						aria-describedby="addon-wrapping"
						id="date-picker"
						[(ngModel)]="workout.date"
						[ngModelOptions]="{ standalone: true }"
					>
				</div>

				<div class="align-items-center d-none d-lg-flex">
					<button
						class="btn btn-dark w-100 me-2"
						(click)="addExerciseToPrebuiltWorkout()"
					>
						Esercizio
						<i class="bi bi-plus"></i>
					</button>

					<button
						class="btn btn-danger w-100"
						(click)="onCancel()"
					>
						Annulla
					</button>
				</div>

				<!--Mobile-->
				<div class=" flex-column align-items-center d-flex d-lg-none">
					<button
						class="btn btn-sm btn-dark w-100 mb-3"
						(click)="addExerciseToPrebuiltWorkout()"
					>
						Aggiungi esercizio
						<i class="bi bi-plus"></i>
					</button>

					<button
						class="btn btn-sm btn-danger w-100"
						(click)="onCancel()"
					>
						Annulla
					</button>
				</div>
			</div>
		</div>

		<div
			*ngFor="
				let exercise of this.workout.exercises;
				index as exerciseIndex
			"
			class="w-100 mb-2"
		>
			<a
				[href]="'#exercise' + exerciseIndex"
				class="btn btn-light w-100 mb-1 border exercise-collapser collapser d-flex justify-content-between align-items-center mobile-btn"
				data-bs-toggle="collapse"
				role="button"
				aria-expanded="false"
				aria-controls="collapseExample"
			>
				<p class="mb-0">
					{{
						exercise.name != "" ? exercise.name : "Nuovo Esercizio"
					}}
				</p>
			</a>

			<div
				class="collapse w-100 exercise-collapse-body collapse-body"
				[id]="'exercise' + exerciseIndex"
			>
				<div class="card card-body p-1">
					<div
						class="d-flex flex-column justify-content-center align-items-center overflow-hidden"
						style="max-height: 60svh; max-width: 95vw"
					>
						<div class="overflow-auto p-3 w-100">
							<form class="d-none d-lg-flex flex-column align-items-center">
								<div class="input-group flex-nowrap mb-3">
									<span class="input-group-text">Esercizio</span>

									<select
										class="form-select"
										aria-label="Default select example"
										style="cursor: pointer"
										[(ngModel)]="exercise.name"
										[ngModelOptions]="{ standalone: true }"
									>
										<option *ngFor="let exercise of availableExercise" [value]="exercise">
											{{ exercise }}
										</option>
									</select>

									<button
										class="btn btn-dark"
										type="button"
										(click)="openCustomExerciseDialog(exercise)"
									>
										Crea
										<i class="ms-1 bi bi-plus-lg"></i>
									</button>
								</div>

								<div
									*ngFor="let set of exercise.set; index as setIndex"
									class="d-flex align-items-center w-100 mb-3"
								>
									<div class="input-group flex-nowrap me-2">
										<span class="input-group-text rounded-start-5">{{ setIndex + 1 }}</span>
										<span class="input-group-text">Reps</span>
										<input
											type="number"
											class="form-control rounded-end-5 me-2"
											[(ngModel)]="exercise.set[setIndex].reps"
											[min]="0"
											[ngModelOptions]="{ standalone: true }"
										/>
										<span class="input-group-text rounded-start-5">Carico</span>
										<input
											type="number"
											class="form-control"
											[(ngModel)]="exercise.set[setIndex].load"
											[min]="0"
											[ngModelOptions]="{ standalone: true }"
										/>
										<span class="input-group-text rounded-end-5">Kg</span>
									</div>

									<div class="d-flex align-items-center">
										<button
											class="btn complete-btn text-light me-2 rounded-5 py-1 px-2"
											style="background-color: #4089c9;"
										>
											<i class="bi bi-check"></i>
										</button>

										<button
											class="btn btn-danger rounded-5 py-1 px-2"
											(click)="deleteSet(exerciseIndex, setIndex)"
										>
											<i class="bi bi-trash3"></i>
										</button>
									</div>
								</div>

								<button
									class="btn btn-dark w-100 mb-3"
									(click)="addSet(exerciseIndex)"
								>
									Aggiungi serie
									<i class="ms-1 bi bi-plus"></i>
								</button>

								<p class="text-center">Intensità (RPE)</p>

								<div
									class="btn-group d-flex justify-content-center mb-3 w-100"
									role="group"
									aria-label="Basic radio toggle button group"
								>
									<input
										type="radio"
										class="btn-check"
										name="btnradio"
										id="btnradio1"
										autocomplete="off"
										[(ngModel)]="exercise.intensity"
										value="light"
									/>
									<label [ngClass]="{'btn border-secondary': true, 'btn-success': exercise.intensity === 'light'}" for="btnradio1">
										Leggero
										<i class="ms-1 bi bi-feather "></i>
									</label>

									<input
										type="radio"
										class="btn-check"
										name="btnradio"
										id="btnradio2"
										autocomplete="off"
										checked
										[(ngModel)]="exercise.intensity"
										value="hard"
									/>
									<label [ngClass]="{'btn border-secondary': true, 'btn-warning': exercise.intensity === 'hard'}" for="btnradio2">
										Pesante
										<i class="ms-1 bi bi-exclamation-triangle-fill "></i>
									</label>

									<input
										type="radio"
										class="btn-check"
										name="btnradio"
										id="btnradio3"
										autocomplete="off"
										[(ngModel)]="exercise.intensity"
										value="failure"
									/>
									<label [ngClass]="{'btn border-secondary': true, 'btn-danger': exercise.intensity === 'failure'}" for="btnradio3">
										Cedimento
										<i class="ms-1 bi bi-fire "></i>
									</label>
								</div>

								<div class="input-group flex-nowrap mb-3">
									<span class="input-group-text">Recupero</span>
									<select
										class="form-select custom-select"
										style="cursor: pointer"
										[(ngModel)]="exercise.rest.minutes"
										[ngModelOptions]="{ standalone: true }"
									>
										<option value="0">00</option>
										<option value="1">01</option>
										<option value="2">02</option>
										<option value="3">03</option>
										<option value="4">04</option>
										<option value="5">05</option>
									</select>
									<span class="input-group-text">:</span>
									<select
										class="form-select custom-select"
										style="cursor: pointer"
										[(ngModel)]="exercise.rest.seconds"
										[ngModelOptions]="{ standalone: true }"
									>
										<option value="0">00</option>
										<option value="15">15</option>
										<option value="30">30</option>
										<option value="45">45</option>
									</select>
								</div>

								<div class="input-group flex-nowrap mb-3">
									<span class="input-group-text">Note</span>
									<input
										type="text"
										class="form-control"
										[(ngModel)]="exercise.note"
										[ngModelOptions]="{ standalone: true }"
									/>
								</div>

								<div class="d-flex align-items-center w-100">
									<button
										class="btn history-btn text-light me-2 w-100 rounded-5"
										style="border: none; background-color: #6b44d4"
										(click)="showOldStats(exerciseIndex)"
									>
										Storico
										<i class="ms-1 bi bi-journal-text"></i>
									</button>
									<button
										class="btn btn-danger w-100 rounded-5"
										(click)="delete(exerciseIndex)"
									>
										Elimina
										<i class="ms-1 bi bi-trash3"></i>
									</button>
								</div>
							</form>

							<!-- Mobile -->
							<form class="d-flex flex-column align-items-center d-lg-none">
								<div class="input-group input-group-sm flex-nowrap mb-3">
									<span class="input-group-text">Esercizio</span>

									<select
										class="form-select"
										aria-label="Default select example"
										style="cursor: pointer"
										[(ngModel)]="exercise.name"
										[ngModelOptions]="{ standalone: true }"
									>
										<option *ngFor="let exercise of availableExercise" [value]="exercise">
											{{ exercise }}
										</option>
									</select>

									<button
										class="btn btn-dark"
										type="button"
										(click)="openCustomExerciseDialog(exerciseIndex)"
									>
										<i class="bi bi-plus-lg"></i>
									</button>
								</div>

								<div
									*ngIf="exercise.set.length !== 0"
									class="d-flex align-items-center w-100"
								>
									<div class="input-group input-group-sm flex-nowrap me-2">
										<input
											type="number"
											class="form-control rounded-5 border-0 me-2"
											placeholder="Reps"
											style="pointer-events: none;"
										/>
										<input
											type="number"
											class="form-control rounded-start-5 border-0"
											placeholder="Carico"
											style="pointer-events: none;"
										/>
										<span class="opacity-0 input-group-text rounded-end-5">Kg</span>
									</div>

									<div class="d-flex align-items-center opacity-0">
										<button
											class="btn btn-sm complete-btn text-light me-1 rounded-5 py-1 px-2"
											style="background-color: #4089c9;"
											disabled
											style="pointer-events: none;"
										>
											<i class="bi bi-check"></i>
										</button>

										<button
											class="btn btn-sm btn-danger rounded-5 py-1 px-2"
											disabled
											style="pointer-events: none;"
										>
											<i class="bi bi-trash3"></i>
										</button>
									</div>
								</div>

								<div
									*ngFor="let set of exercise.set; index as setIndex"
									class="d-flex align-items-center w-100 mb-3"
								>
									<div class="input-group input-group-sm flex-nowrap me-2">
										<input
											type="number"
											class="form-control rounded-5 me-2"
											placeholder="Reps"
											[(ngModel)]="exercise.set[setIndex].reps"
											[min]="0"
											[ngModelOptions]="{ standalone: true }"
										/>
										<input
											type="number"
											class="form-control rounded-start-5"
											placeholder="Carico"
											[(ngModel)]="exercise.set[setIndex].load"
											[min]="0"
											[ngModelOptions]="{ standalone: true }"
										/>
										<span class="input-group-text rounded-end-5">Kg</span>
									</div>

									<div class="d-flex align-items-center">
										<button
											class="btn btn-sm complete-btn text-light me-1 rounded-5 py-1 px-2"
											style="background-color: #4089c9;"
										>
											<i class="bi bi-check"></i>
										</button>

										<button
											class="btn btn-sm btn-danger rounded-5 py-1 px-2"
											(click)="deleteSet(exerciseIndex, setIndex)"
										>
											<i class="bi bi-trash3"></i>
										</button>
									</div>
								</div>

								<button
									class="btn btn-sm btn-dark w-100 mb-3"
									(click)="addSet(exerciseIndex)"
								>
									Aggiungi serie
									<i class="ms-1 bi bi-plus"></i>
								</button>

								<div class="input-group input-group-sm flex-nowrap mb-3">
									<span class="input-group-text">Intensità</span>
									<select
										class="form-select custom-select"
										style="cursor: pointer"
										[(ngModel)]="exercise.intensity"
										[ngModelOptions]="{ standalone: true }"
									>
										<option value="light">
											Leggero
										</option>
										<option value="hard" selected>
											Pesante
										</option>
										<option value="failure">
											Cedimento
										</option>
									</select>
								</div>

								<div class="input-group input-group-sm flex-nowrap mb-3">
									<span class="input-group-text">
										<i class="bi bi-stopwatch-fill"></i>
									</span>
									<select
										class="form-select custom-select"
										style="cursor: pointer"
										[(ngModel)]="exercise.rest.minutes"
										[ngModelOptions]="{ standalone: true }"
									>
										<option value="0">00</option>
										<option value="1">01</option>
										<option value="2">02</option>
										<option value="3">03</option>
										<option value="4">04</option>
										<option value="5">05</option>
									</select>
									<span class="input-group-text">:</span>
									<select
										class="form-select custom-select"
										style="cursor: pointer"
										[(ngModel)]="exercise.rest.seconds"
										[ngModelOptions]="{ standalone: true }"
									>
										<option value="0">00</option>
										<option value="15">15</option>
										<option value="30">30</option>
										<option value="45">45</option>
									</select>
								</div>

								<div class="input-group input-group-sm flex-nowrap mb-3">
									<span class="input-group-text">Note</span>
									<input
										type="text"
										class="form-control"
										[(ngModel)]="exercise.note"
										[ngModelOptions]="{ standalone: true }"
									/>
								</div>

								<div class="d-flex align-items-center w-100">
									<button
										class="btn btn-sm history-btn text-light me-2 w-100 rounded-5"
										style="border: none; background-color: #6b44d4"
										(click)="showOldStats(exerciseIndex)"
									>
										<i class="bi bi-journal-text"></i>
									</button>
									<button
										class="btn btn-sm btn-danger w-100 rounded-5"
										(click)="delete(exerciseIndex)"
									>
										<i class="bi bi-trash3"></i>
									</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
